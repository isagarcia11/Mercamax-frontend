<div class="reports-container">
  
  <mat-card class="report-card">
    <mat-card-header>
      <mat-card-title>Reporte de Valoración de Inventario</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>Calcula el valor total del inventario basándose en el costo promedio de los productos en stock.</p>
      
      <div class="report-actions">
        <button mat-raised-button color="primary" (click)="generarValoracion()">Generar Reporte de Valoración</button>
        <button mat-raised-button class="export-button" (click)="exportarAExcel()" [disabled]="!valoracionData">
          <mat-icon>file_download</mat-icon> Exportar Excel
        </button>
        <button mat-raised-button class="export-button" (click)="exportarAPdf()" [disabled]="!valoracionData">
          <mat-icon>picture_as_pdf</mat-icon> Exportar PDF
        </button>
      </div>

      <div *ngIf="valoracionData" class="report-results">
        <div class="summary-card">
          <h4>Valor Total del Inventario</h4>
          <span class="value">{{ valoracionData.valor_total_inventario | currency:'COP':'symbol':'1.0-2' }}</span>
        </div>
        
        <div class="table-container">
          <table mat-table [dataSource]="valoracionData.detalles">
            <ng-container matColumnDef="producto">
              <th mat-header-cell *matHeaderCellDef>Producto</th>
              <td mat-cell *matCellDef="let item">{{ item.producto }}</td>
            </ng-container>

            <ng-container matColumnDef="stock_total">
              <th mat-header-cell *matHeaderCellDef>Stock Total</th>
              <td mat-cell *matCellDef="let item">{{ item.stock_total }}</td>
            </ng-container>

            <ng-container matColumnDef="costo_promedio">
              <th mat-header-cell *matHeaderCellDef>Costo Promedio</th>
              <td mat-cell *matCellDef="let item">{{ item.costo_promedio | currency:'COP':'symbol':'1.0-2' }}</td>
            </ng-container>

            <ng-container matColumnDef="valor_total">
              <th mat-header-cell *matHeaderCellDef>Valor Total</th>
              <td mat-cell *matCellDef="let item">{{ item.valor_total | currency:'COP':'symbol':'1.0-2' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

<mat-card class="report-card">
  <mat-card-header>
    <mat-card-title>Reporte de Rotación de Inventario</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>Mide la cantidad de veces que el inventario se ha vendido o reemplazado en un período.</p>
    
    <div class="report-actions">
      <button mat-raised-button color="primary" (click)="calcularRotacion()">Calcular Rotación Anual</button>
    </div>
    
    <div *ngIf="rotacionData" class="report-results">
      <div class="turnover-cards">
        <mat-card class="metric-card">
          <h4>Período</h4>
          <p>{{ rotacionData.periodo }}</p>
        </mat-card>
        <mat-card class="metric-card">
          <h4>Costo de Ventas</h4>
          <p>{{ rotacionData.costo_de_ventas | currency:'COP':'symbol':'1.0-2' }}</p>
        </mat-card>
        <mat-card class="metric-card">
          <h4>Inventario Promedio</h4>
          <p>{{ rotacionData.inventario_promedio | currency:'COP':'symbol':'1.0-2' }}</p>
        </mat-card>
      </div>

      <mat-card class="result-card" [ngClass]="{'ok': rotacionSuperaObjetivo, 'warning': !rotacionSuperaObjetivo}">
        <h3>Rotación de Inventario: {{ rotacionData.rotacion_de_inventario | number:'1.2-2' }} veces</h3>
        <p *ngIf="rotacionSuperaObjetivo">🎉 ¡Objetivo de rotación alcanzado! (>= {{ objetivoRotacion }})</p>
        <p *ngIf="!rotacionSuperaObjetivo">⚠️ La rotación de inventario está por debajo del objetivo de {{ objetivoRotacion }} veces.</p>
      </mat-card>
    </div>
    <div *ngIf="!rotacionData">
    </div>
  </mat-card-content>
</mat-card>